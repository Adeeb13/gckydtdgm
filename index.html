import { useEffect, useRef } from 'react';

export function UniverseBackground() {
const canvasRef = useRef<HTMLCanvasElement>(null);

    useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    // Set canvas size
    const resizeCanvas = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    };
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Particle system
    interface Particle {
    x: number;
    y: number;
    vx: number;
    vy: number;
    size: number;
    opacity: number;
    color: string;
    type: 'star' | 'dust' | 'nebula';
    }

    const particles: Particle[] = [];

    // Create particles
    const createParticles = () => {
    particles.length = 0;

    // Stars
    for (let i = 0; i < 150; i++) { particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height,
        vx: (Math.random() - 0.5) * 0.3, vy: (Math.random() - 0.5) * 0.3, size: Math.random() * 1.5, opacity:
        Math.random() * 0.7 + 0.3, color: `hsl(${Math.random() * 60 + 200}, 100%, ${Math.random() * 30 + 60}%)`,
        type: 'star' , }); } // Dust particles for (let i=0; i < 200; i++) { particles.push({ x: Math.random() *
        canvas.width, y: Math.random() * canvas.height, vx: (Math.random() - 0.5) * 0.1, vy: (Math.random() - 0.5) *
        0.1, size: Math.random() * 0.5, opacity: Math.random() * 0.3 + 0.1, color: `hsl(${Math.random() * 40 + 260},
        80%, 50%)`, type: 'dust' , }); } // Nebula particles for (let i=0; i < 50; i++) { particles.push({ x:
        Math.random() * canvas.width, y: Math.random() * canvas.height, vx: (Math.random() - 0.5) * 0.05, vy:
        (Math.random() - 0.5) * 0.05, size: Math.random() * 100 + 50, opacity: Math.random() * 0.15 + 0.05, color:
        `hsl(${Math.random() * 60 + 240}, 100%, 50%)`, type: 'nebula' , }); } }; createParticles(); // Animation loop
        let animationId: number; const animate=()=> {
        // Clear canvas with space background
        const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        gradient.addColorStop(0, '#0a0e27');
        gradient.addColorStop(0.5, '#0f1a3d');
        gradient.addColorStop(1, '#050812');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw nebula glow
        particles.forEach((p) => {
        if (p.type === 'nebula') {
        const nebula = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size);
        nebula.addColorStop(0, `hsla(${Math.random() * 60 + 240}, 100%, 50%, ${p.opacity})`);
        nebula.addColorStop(1, `hsla(${Math.random() * 60 + 240}, 100%, 50%, 0)`);
        ctx.fillStyle = nebula;
        ctx.fillRect(p.x - p.size, p.y - p.size, p.size * 2, p.size * 2);
        }
        });

        // Update and draw particles
        particles.forEach((p) => {
        p.x += p.vx;
        p.y += p.vy;

        // Wrap around screen
        if (p.x < 0) p.x=canvas.width; if (p.x> canvas.width) p.x = 0;
            if (p.y < 0) p.y=canvas.height; if (p.y> canvas.height) p.y = 0;

                // Draw particle
                if (p.type === 'star') {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.opacity;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();

                // Star glow
                ctx.strokeStyle = p.color;
                ctx.lineWidth = 0.5;
                ctx.globalAlpha = p.opacity * 0.3;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * 2, 0, Math.PI * 2);
                ctx.stroke();
                } else if (p.type === 'dust') {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.opacity;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                }
                });

                ctx.globalAlpha = 1;

                // Draw shooting stars occasionally
                if (Math.random() < 0.002) { const startX=Math.random() * canvas.width; const startY=Math.random() *
                    canvas.height; const length=Math.random() * 100 + 50; const angle=Math.random() * Math.PI * 2;
                    ctx.strokeStyle='rgba(255, 255, 255, 0.8)' ; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(startX,
                    startY); ctx.lineTo( startX + Math.cos(angle) * length, startY + Math.sin(angle) * length );
                    ctx.stroke(); } animationId=requestAnimationFrame(animate); }; animate(); return ()=> {
                    cancelAnimationFrame(animationId);
                    window.removeEventListener('resize', resizeCanvas);
                    };
                    }, []);

                    return (
                    <canvas ref={ canvasRef } className="fixed inset-0 -z-10" style={{
                        background: 'linear-gradient(135deg, #0a0e27 0%, #0f1a3d 50%, #050812 100%)' } } />
                    );
                    }